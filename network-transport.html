<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.4 at 2016-11-16 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>mpc4j - </title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20161116" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                mpc4j
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 2016-11-16</span>
                  &nbsp;| <span id="projectVersion">Version: 1.0.0.Beta01-SNAPSHOT</span>
                      </div>
            <div class="xright">        
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>Examples</h5>
                  <ul>
                  <li class="none">
                          <a href="invoking-commands.html" title="invoking commands">invoking commands</a>
            </li>
                  <li class="none">
            <strong>network transport</strong>
          </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                        <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                      <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1>Sending Commands and Receiving Responses</h1>
<p>The developer using this library would provide an implementation to send the command and receive the request. Such an implementation, perhaps a method named <tt>send</tt>, would be implemented to use the Command and Response this way:</p>

<div class="source">
<pre>/**
 * A sample MPC implementation.
 */
class MPC {
    /**
     * use a socket channel to send the command and read response.
     *        
     * @param command to send
     * @return MPD's response to the command 
     */
    public &lt;R extends Command.Response&gt; R send(final Command command) throws IOException {
        final List&lt;String&gt; result;
        // try-with-resource: opens socket, a a writer toMpd, and a reader fromMpd
        final SocketAddress address = new InetSocketAddress(host, port);
        try (SocketChannel channel = SocketChannel.open()) {

            channel.connect(address);

            final BufferedReader fromMpd = new BufferedReader(Channels.newReader(channel, UTF_8.newDecoder(), -1));

            String connectResponse;
            // first, expect the connect status
            while ((connectResponse = fromMpd.readLine()) != null) {
                if (responseComplete(connectResponse)) {
                    break;
                }
            }

            // now send the command as text
            final ByteBuffer outGoing = ByteBuffer.wrap((command.text() + &quot;\n&quot;).getBytes(UTF_8));
            channel.write(outGoing);

            // then read response into a List
            final List&lt;String&gt; lines = new ArrayList&lt;&gt;();
            String responseSegment;
            while ((responseSegment = fromMpd.readLine()) != null) {
                lines.add(responseSegment);
                if (responseComplete(responseSegment)) {
                    break;
                }
            }

            result = lines;
        }
        return (R) command.response(result);
    }

    /**
     * @return true if this is the last line of a command's response. 
     */
    private static boolean responseComplete(final String response) {
        return response.startsWith(&quot;OK&quot;) || response.startsWith(&quot;ACK&quot;);
    }

}
</pre></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                   2016.
          All Rights Reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
